### База данных
Сервису `osago-aggregator` требуется собственное хранилище данных. Оно будет использоваться для хранения заявок на ОСАГО, статусов опроса страховых компаний и кэширования ответов на предложения. Для этих целей может использоваться реляционная база данных (например, PostgreSQL) или NoSQL для быстрого доступа к данным. База данных также будет обеспечивать согласованность данных через механизм транзакционной публикации (Transactional Outbox) — когда данные одновременно сохраняются в БД и публикуются в Kafka.

### API для core-app

1. **POST** `/osago/submit-and-stream`: создание заявки на ОСАГО и подписка на предложения (SSE).
  - **Описание**: Клиент отправляет данные для создания заявки, и открывается SSE-соединение для получения предложений от страховых компаний в реальном времени.
  - **Запрос**: Данные автомобиля, клиента и прочая необходимая информация для оформления ОСАГО.
  - **Ответ**: Подтверждение создания заявки с `requestId` и последующая отправка предложений через SSE по мере их поступления.

2. **GET** `/osago/request/{requestId}`: получение данных по заявке на ОСАГО.
  - **Описание**: Получение полной информации по конкретной заявке (включая предложения от страховых компаний).
  - **Запрос**: `requestId` — идентификатор заявки.
  - **Ответ**: Данные по заявке, включая предложения от страховых компаний, если они уже доступны.

### API для osago-aggregator

1. **POST** `/osago/request`: создание заявки ко всем вендорам ОСАГО.
- **Описание**: Создание заявки на ОСАГО, после чего сервис асинхронно отправляет запросы всем подключённым вендорам страховых услуг. Этот запрос не возвращает предложения сразу, а лишь подтверждает, что процесс отправки заявок вендорам начат. Получение предложений от вендоров обрабатывается асинхронно и поступает в дальнейшем через другой запрос (kafka или REST API).
- **Запрос**: Данные автомобиля и прочая необходимая информация для оформления ОСАГО.
- **Ответ**: HTTP 200 OK, подтверждающий успешное создание заявки и запуск асинхронного процесса опроса вендоров.

1. **GET** `/osago/request/{requestId}`: получение данных по заявке ОСАГО.
  - **Описание**: Получение информации по заявке на ОСАГО из базы данных, включая текущий статус обработки и предложения.
  - **Запрос**: `requestId` — идентификатор заявки.
  - **Ответ**: Данные заявки, включая предложения от страховых компаний.

2. **Kafka-топик** `osago-offers`: публикация предложений страховых компаний.
  - **Описание**: `osago-aggregator` отправляет предложения от страховых компаний в Kafka-топик после их получения.
  - **Сообщение**: Информация о предложениях для заявки с указанным `requestId`.

### Паттерны отказоустойчивости

1. **Rate Limiting** (в core-app для создания заявок)
  - **Описание**: Ограничение количества создаваемых заявок на ОСАГО в `core-app`, чтобы предотвратить перегрузку системы. Этот паттерн поможет контролировать нагрузку на сервер при повышенном трафике, ограничивая количество заявок, которые могут быть созданы за определённый период времени.

2. **Bulkhead** (в osago-aggregator для запросов к страховым компаниям)
  - **Описание**: Изолирование запросов к разным страховым компаниям в отдельные тредпулы, чтобы проблемы с одной компанией не повлияли на общую доступность сервиса. Это позволит уменьшить влияние перегрузки или отказов конкретного вендора на всю систему.

3. **Circuit Breaker** (в osago-aggregator для запросов к страховым компаниям)
  - **Описание**: Паттерн, который временно блокирует взаимодействие с вендором, если количество ошибок или задержек превышает установленный порог. Это предотвращает дополнительные попытки взаимодействия с недоступными или медленными страховыми компаниями, уменьшая время отклика системы и повышая её отказоустойчивость.

4. **Timeout** (в osago-aggregator для запросов к страховым компаниям)
  - **Описание**: Установить тайм-аут в 60 секунд для ожидания ответа от страховых компаний. Если ответ не поступает в этот период, продолжать обработку с доступными предложениями.
