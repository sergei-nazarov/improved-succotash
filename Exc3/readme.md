# Анализ текущей архитектуры и проблемы, связанные с REST API

## Описание текущей архитектуры
1. **Запросы данных о продуктах**:
   - Сервис `core-app` делает запросы в `ins-product-aggregator` раз в 15 минут, чтобы получить информацию о продуктах и тарифах. Эти данные реплицируются локально.
   - Сервис `ins-comp-settlement` делает подобные запросы раз в сутки для формирования реестра оформленных страховок.

2. **Локальные реплики данных**:
   - Для повышения скорости работы команды решили хранить локальные копии данных о продуктах и тарифах в сервисах `core-app` и `ins-comp-settlement`.

3. **Синхронные запросы к API**:
   - В момент запроса к `ins-product-aggregator` сервисы запрашивают информацию у всех страховых компаний (сейчас их пять) и агрегируют её в единый список.

4. **Периодические взаимодействия**:
   - Помимо запросов на получение данных о продуктах, `ins-comp-settlement` делает ещё один ежедневный запрос к `core-app` для получения информации обо всех оформленных за день страховках.

## Проблемы и риски
1. **Ошибки при взаимодействии с API страховых компаний**:
   - **Проблема**: Задержки в ответах и ошибки при взаимодействии с API страховщиков приводят к ошибкам в работе `core-app` и `ins-comp-settlement`. Это особенно критично для `ins-comp-settlement`, который формирует реестр страховых случаев.
   - **Риск**: Рост количества страховых компаний (планируется добавить ещё пять) увеличит вероятность задержек и ошибок при запросах.

2. **Нагрузка на `ins-product-aggregator`**:
   - **Проблема**: Синхронные запросы от `core-app` и `ins-comp-settlement` создают значительную нагрузку на `ins-product-aggregator`, особенно если учесть, что каждый запрос инициирует обращение ко всем интегрированным страховым компаниям.
   - **Риск**: Увеличение числа страховых компаний повысит нагрузку на `ins-product-aggregator`, что может привести к ещё большим задержкам и ошибкам.

3. **Задержки в обновлении данных**:
   - **Проблема**: `core-app` обновляет данные о продуктах каждые 15 минут, а `ins-comp-settlement` — раз в сутки. Это может привести к тому, что пользователи будут видеть устаревшие тарифы, а расчёты по агентским премиям будут выполняться на основе устаревшей информации.
   - **Риск**: Возникает риск, что пользователи получат некорректные тарифы, а расчёты страховок будут неверными.

## Решения проблем
1. **Переход на Event-Driven архитектуру**:
   - Вместо синхронных запросов к `ins-product-aggregator`, сервисы `core-app` и `ins-comp-settlement` могут получать обновления продуктов через поток событий в реальном времени.
   - **Преимущества**: Ускорение обработки данных, снижение нагрузки на API страховых компаний, устранение необходимости в периодическом опросе.

2. **Отправка обновлений в реальном времени**:
   - `ins-product-aggregator` может публиковать обновления тарифов в Kafka, и `core-app` и `ins-comp-settlement` будут подписываться на эти события.
   - **Преимущества**: Устранение задержек в обновлении данных и ошибок при взаимодействии с внешними API.

